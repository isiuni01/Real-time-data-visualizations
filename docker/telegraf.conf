# Telegraf agent configuration
[agent]
  interval = "500ms"
  flush_interval = "500ms"
  debug = true
  hostname = "telegraf-boat"  # opzionale, ma utile nei tag

###############################################################################
# INPUT PLUGIN - Internal metrics (Telegraf's own performance)
###############################################################################

[[inputs.internal]]
  ## Collect internal metrics about Telegraf itself
  collect_memstats = true

###############################################################################
# INPUT PLUGIN - System metrics (CPU, Memory, Disk)
###############################################################################

[[inputs.cpu]]
  ## Whether to report per-cpu stats or not
  percpu = true
  ## Whether to report total system cpu stats or not
  totalcpu = true
  ## If true, collect raw CPU time metrics
  collect_cpu_time = false
  ## If true, compute and report the sum of all non-idle CPU states
  report_active = false

[[inputs.mem]]
  # no configuration

[[inputs.disk]]
  ## Ignore mount points by filesystem type.
  ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]

###############################################################################
# INPUT PLUGIN - Kafka consumer
###############################################################################

[[inputs.kafka_consumer]]
  name_override = "navigazione"
  brokers = ["kafka:19091"]
  topics = ["boat_data_navigation"]
  consumer_group = "telegraf-boat-group"
  client_id = "telegraf-boat-client"
  offset = "oldest"
  max_message_len = 1000000
  data_format = "json"

  # Timestamp per InfluxDB
  json_time_key = "timestamp"
  json_time_format = "RFC3339"

  # Tag: trattati come identificatori (testi)
  tag_keys = ["boat"]

[[inputs.kafka_consumer]]
  name_override = "BoatvsBoat"
  brokers = ["kafka:19091"]
  topics = ["boat_race_data"]
  consumer_group = "telegraf-boat-group"
  client_id = "telegraf-boat-client"
  offset = "oldest"
  max_message_len = 1000000
  data_format = "json"

  # Timestamp per InfluxDB
  json_time_key = "timestamp"
  json_time_format = "RFC3339"

  # Tag: trattati come identificatori (testi)
  tag_keys = ["boat", "race_number", "opponent"]


###############################################################################
# OUTPUT PLUGIN - InfluxDB v2
###############################################################################

[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "dBJ2aNAEWZPLA6zcqF69YyGE0GjrkgPaNC_E2Y5jRA4hjJYQ47eXg1LhFNgTxNWPv3hLjavShTA7MS-DoehPIQ=="
  organization = "my-org"
  bucket = "Navigation"
  namepass = ["navigazione", "BoatvsBoat"]

###############################################################################
# OUTPUT PLUGIN - Prometheus Client
###############################################################################

[[outputs.prometheus_client]]
  listen = ":9273"
  metric_version = 2
  path = "/metrics"
  expiration_interval = "60s"
  string_as_label = true

  ## Include system metrics and all internal metrics (including write timing)
  namepass = ["internal_*", "cpu", "mem", "disk"]


